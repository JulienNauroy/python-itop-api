#!/usr/bin/env python

__version__ = '1.0'
__authors__ = ['Guillaume Philippon <guillaume.philippon@lal.in2p3.fr>']

from itopapi import ItopapiRack, ItopapiServer
import argparse

parse = argparse.ArgumentParser(description="python CLI for iTop REST api")
parse.add_argument('--hostname', dest='hostname', help='URI of rest API of itop')
parse.add_argument('--username', dest='username', help='Username')
parse.add_argument('--password', dest='password', help='Password')
options = parse.parse_args()

racks = ItopapiRack()
# Protocol ( http / https)
racks.protocol = 'https'
# hostname of server
racks.hostname = options.hostname
# suffix to add to access to http instance (https://itop.domain.com/itop per example)
racks.base_suffix = '/itop'
# username & password
racks.password = options.password
racks.username = options.username

response = racks.list_command()
print response
print '#' * 80
print 'List Available operations'
for operation in response['operations']:
    print 'Action: {0}'.format(operation['verb'])
print '#' * 80

itop_racks = racks.list_objects()
print 'List Racks'
try:
    for rack in itop_racks['objects']:
        print itop_racks['objects'][rack]['fields']['friendlyname']
    print '#' * 80
except:
    pass

servers = ItopapiServer()
servers.protocol = 'https'
servers.hostname = options.hostname
servers.base_suffix = '/itop'
servers.password = options.password
servers.username = options.username

itop_servers = servers.list_objects()
print 'List Servers'

try:
    for server in itop_servers['objects']:
        print itop_servers['objects'][server]['fields']['friendlyname']
    print '#' * 80
except:
    pass
